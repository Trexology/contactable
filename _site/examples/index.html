<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>Examples</title>
  <meta name="description" content="A Laravel package designed to enhance Eloquent users (or any other model) with relations to multiple e-mail addresses and phone numbers, additionally allowing users to login with any of the above.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://contactable.gridprinciples.com/examples/">
  <link rel="alternate" type="application/atom+xml" title="Contactable" href="http://contactable.gridprinciples.com/feed.xml" />
  <link href='http://fonts.googleapis.com/css?family=Rubik:700,300' rel='stylesheet' type='text/css'>
</head>


  <body>

    <header class="site-header">

  <div class="container">

    <a class="site-title" href="/"><i class="fa fa-book">&nbsp;</i>Contactable</a>

    <nav class="site-nav">
      
      
      
        
      
      
      
        
      
      
      
      
      
        
      
      
      
        
          
          <a href="/install/">Install</a>
          
        
      
      
      
        
          
          <a href="/usage/">Usage</a>
          
        
      
      
      
        
          
          <a href="/examples/" class="active">Examples</a>
          
        
      
      
    </nav>

    <p class="site-description">A Laravel package designed to enhance Eloquent users (or any other model) with relations to multiple e-mail addresses and phone numbers, additionally allowing users to login with any of the above.
</p>

  </div>

</header>


    <div class="page-content">
  <div class="container">
    <div class="post">

      <header class="post-header">
        <h1 class="post-title">Examples</h1>
      </header>

      <article class="post-content">
        <p>For any models you would like to have their own phone numbers or e-mail addresses, add the appropriate trait:</p>

<pre><code>use Phonable;  
use Emailable;
</code></pre>

<p>…or use the <code>Contactable</code> trait to quickly add phones <em>and</em> e-mails:</p>

<pre><code>use Contactable;
</code></pre>

<p>The above traits simply add the appropriate relationships to your model.  Now, you may query the relationships using
<a href="http://laravel.com/docs/5.1/eloquent-relationships#querying-relations">Eloquent</a> as you normally would.</p>

<p><strong>E-mail addresses</strong> are accessed via the “emails()” method (a MorphMany relationship):</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="c1">// Add an e-mail address to a new model</span>
<span class="nv">$model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">;</span>
<span class="nv">$model</span><span class="o">-&gt;</span><span class="na">emails</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">new</span> <span class="nx">\GridPrinciples\Contactable\EmailAddress</span><span class="p">([</span><span class="s1">&#39;address&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;zero@example.com&#39;</span><span class="p">]));</span>

<span class="c1">// Add multiple e-mail addresses to a pre-existing model</span>
<span class="nv">$model</span> <span class="o">=</span> <span class="nx">Model</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$model</span><span class="o">-&gt;</span><span class="na">emails</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">saveMany</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">\GridPrinciples\Contactable\EmailAddress</span><span class="p">([</span><span class="s1">&#39;address&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;one@example.com&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">\GridPrinciples\Contactable\EmailAddress</span><span class="p">([</span><span class="s1">&#39;address&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;two@example.com&#39;</span><span class="p">]),</span>
<span class="p">]);</span>

<span class="c1">// Query records which have at least two e-mail addresses</span>
<span class="nx">Model</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

<span class="c1">// Query records which have a specific e-mail address</span>
<span class="nv">$address</span> <span class="o">=</span> <span class="s1">&#39;three@example.com&#39;</span><span class="p">;</span>
<span class="nx">Model</span><span class="o">::</span><span class="na">whereHas</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$address</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$address</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<p><strong>Phone numbers</strong> are accessed via the “phones()” method (a MorphMany relationship):</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="c1">// Add a phone number to a new model</span>
<span class="nv">$model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">;</span>
<span class="nv">$model</span><span class="o">-&gt;</span><span class="na">phones</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="k">new</span> <span class="nx">\GridPrinciples\Contactable\PhoneNumber</span><span class="p">([</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;123 4567&#39;</span><span class="p">]));</span>

<span class="c1">// Add multiple phone numbers to a pre-existing model</span>
<span class="nv">$model</span> <span class="o">=</span> <span class="nx">Model</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$model</span><span class="o">-&gt;</span><span class="na">phones</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">saveMany</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">\GridPrinciples\Contactable\PhoneNumber</span><span class="p">([</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;(234) 567-8900&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">\GridPrinciples\Contactable\PhoneNumber</span><span class="p">([</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2222222&#39;</span><span class="p">]),</span>
<span class="p">]);</span>

<span class="c1">// Query records which have at least two phone numbers</span>
<span class="nx">Model</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;phones&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

<span class="c1">// Query records which have a specific phone number</span>
<span class="nv">$number</span> <span class="o">=</span> <span class="s1">&#39;(000) 011-0000&#39;</span><span class="p">;</span>
<span class="nx">Model</span><span class="o">::</span><span class="na">whereHas</span><span class="p">(</span><span class="s1">&#39;phones&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$number</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;raw_number&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/[^0-9]/&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$number</span><span class="p">));</span> <span class="c1">// query only the numbers</span>
<span class="p">});</span></code></pre></div>


      </article>

    </div>
  </div>
</div>


    <footer class="site-footer">

  <div class="container">

    <ul class="social-links">
      
      
      <li>
        <a href="http://github.com/gridprinciples/contactable">
          <i class="fa fa-github">&nbsp;</i>
          <span class="sr-only">http://github.com/gridprinciples/contactable</span>
        </a>
      </li>
      
      
    </ul>

    <div class="site-info">
      <h2 class="footer-heading">Contactable</h2>
      <p class="legal">
        <!--Developed by <a href="http://contactable.gridprinciples.com"><i class="fa fa-grid-principles">&nbsp;</i><span class="sr-only">Grid Principles</span></a>-->
        <!--&bull;&nbsp;-->
        Licensed under <a href="https://github.com/gridprinciples/contactable/blob/master/license.txt">MIT</a>
      </p>
    </div>

  </div>

</footer>


  </body>

</html>
